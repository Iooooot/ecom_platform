# ecom_platform

## 中期需要完成部分：

- ✅用户管理功能（注册、登陆、个人信息，**普通用户角色部分**）

  （1）✅注册与登录：支持邮箱/手机号注册，验证码校验；支持用户名+密码登录，集成第三方登录（微信、支付宝等）；忘记密码时可通过邮箱/手机号找回。

  （2）✅个人信息管理：查看和修改个人信息（如姓名、性别、年龄、联系方式、密码等）；

  绑定/解绑邮箱、手机号、第三方账号；可以进行短信验证。

  （3）✅地址管理：添加、编辑、删除收货地址，并设置默认地址；可以集成地图API自动匹配省市区、街道信息。

  （4）✅消费统计：可以查看某个时间段内的消费统计（如每日/每周/每月/自定义周期查看消费记录）；柱状图或折线图展示消费趋势（如总花销、订单量）；按商品类别（如食品、服饰显示消费占比）；支持导出Excel/PDF格式的消费明细。
  

> **注册与登录✅**
>
> -  ✅支持邮箱、手机号注册，验证码校验
> - ✅用户名+密码登录
> - ✅集成支付宝第三方登录
> -  ✅忘记密码，通过邮箱/手机号找回密码
>
> **个人信息管理✅**
>
> - ✅查看/修改个人信息（姓名、性别、年龄、联系方式、密码）
>   - ✅查看个人信息：除密码外都可以看
>   - ✅修改个人信息：除密码外都修改
>   - ✅密码修改（重置密码接口）：
>     - ✅根据邮箱获取验证码
>     - ✅根据验证码以及对应新密码进行密码修改
> - ✅绑定/解绑邮箱、手机号、第三方账号，支持短信验证
>   - ✅绑定/解绑邮箱
>   - ✅绑定/解绑手机号
>   - ✅绑定/解绑第三方账号
>
> **地址管理✅** 
>
> - ✅添加、编辑、删除收货地址 
>
>   - ✅添加
>
>     ```json
>     {
>       "recipientName": "张三",
>       "phone": "13812345678",
>       "addressLine1": "阳光小区12号楼",
>       "addressLine2": "3单元401室",
>       "city": "北京市",
>       "state": "海淀区",
>       "postalCode": "100081",
>       "country": "中国",
>       "isDefault": true
>     }
>     ```
>
>   - ✅编辑
>   - ✅删除收货
>
> - ✅设置默认地址
>
> **消费统计✅** ，见静态页面http://localhost:8088/consumption-stats.html
>
> - ✅按时间段统计消费记录，支持每日/每周/每月/自定义周期
>
> - ✅图表展示（柱状图、折线图）
> - ✅按商品类别分析消费占比

- 管理员用户管理（敏感操作部分先不做，**管理员角色部分**）

  （1）✅用户列表：查看用户ID、注册时间、消费总额等。

  （2）✅权限管控：分配用户角色（普通用户，VIP用户），禁用违规账号。


> - ✅用户列表
>   - ✅全列表分页查询
>   - ✅ID
>   - ✅邮箱
>   - ✅注册时间
>   - ✅消费总额
> - ✅角色管理（普通用户/VIP用户）
> - ✅账号禁用
>

## 所有功能已全部完成✅

用户端：

- ✅商品搜索与浏览（商品搜索、筛选、查看详情）

  - ✅**商品搜索与筛选** 

    - ✅支持关键词搜索，并根据分类、价格区间、销量等条件筛选；价格从低到高、销量排序、新品优先等。

  - ✅**商品详情查看**

    商品详情查看：查看商品的详细信息（如图片、描述、价格、库存等）；显示评分、文字/图片评价、追评，支持按好评/差评筛选。

    - ✅商品图片、描述、价格、库存、评分
    - ✅文字/图片评价，支持按好评/差评筛选


- ✅购物车

  添加商品到购物车，支持批量修改数量或删除；显示商品总价、优惠抵扣；库存不足或下架商品自动标记，提示用户清理（前端做的）。

  - ✅添加商品，批量修改数量、删除
  - ✅显示商品总价、优惠
  - ✅库存不足或下架商品提示清理

- ✅订单管理（用户端）

  查看订单状态（如待支付、已支付、已发货、已完成等）；取消未支付的订单（或者超时自动取消）；对已完成订单的商品进行评分和图文评价（已完成，前端只需要在已完成状态的订单显示评论按钮调用评论接口即可）。

  - ✅订单状态（待支付、已支付、已发货、已完成）
  - ✅取消未支付订单（超时自动取消）
  - ✅对已完成订单的商品评分和评价
  

管理员端：

- ✅管理员订单管理（订单筛选、退换货审核、手动标记订单发货）

  - ✅订单筛选（按时间、用户ID、状态、支付方式）
  - ✅退换货处理：审核用户退货申请，确认退款金额。
  - ✅人工干预：手动标记订单为已发货。
- ✅管理员商品管理

  - **分类管理** 
    - 支持多级分类（如电子产品->手机->苹果手机）
  
  - **商品管理** 
      - 添加、编辑、删除商品信息（如名称、描述、价格、库存、商品图片等）
- ✅用户管理（敏感操作部分）

  - 记录敏感操作日志（密码修改、删除评价）
- ✅优惠券

  - 创建优惠券
  - 绑定用户发放优惠券（选择用户，手动发放即可）
  - 创建优惠券（满减、折扣）活动，绑定指定商品。
- ✅加密

  - 数据库密码存储加密（如bcrypt）
- ✅数据统计：

  - 实时销售额、订单量、热销商品Top10
  - 按地区、用户年龄段分析消费偏好
  - 自动日报/周报/月报（支持PDF/Excel）
  - 可视化数据看板（拖拽生成图表）

## 表结构说明

**3.1.1** **用户基本信息表**

```
users 
(user_id（整数）：用户ID（主键）
username（字符串）：用户名
password（字符串）：用户密码（加密存储）
email（字符串）：用户电子邮箱
phone（字符串）：用户手机号码
age（整数）：用户年龄
role（整数）：0-普通用户，1-VIP用户，2-管理员
gender（字符串）：用户性别
is_vip（布尔）：用户是否为会员
create_time（字符串）：用户创建时间
update_time（字符串）：用户信息更新时间)
```

**3.1.2** **商品分类表**

```
categories 
(category_id（字符串）：类别ID（主键）
name（字符串）：类别名称
parent_id（字符串）：父分类ID)
```

**3.1.3** **商品表**

```
products
 (product_id（字符串）：商品ID（主键）
name（字符串）：商品名
description（字符串）：商品描述
price（浮点数）：商品价格
stock（整数）：商品库存
category_id（字符串）：商品所属类别ID
create_time（字符串）：商品创建时间
update_time（字符串）)：商品信息更新时间
```

**3.1.4** **地址表**

```
addresses 
(address_id（字符串）：地址ID（主键）
user_id（字符串）：收货人ID/用户ID
recipient_name（字符串）：收货人姓名
phone（字符串）：收货人手机号码
address_line1, address_line2,（字符串）：两个地址行
city（字符串）：收货人城市
state（字符串）：收货人省份/州
postal_code（字符串）: 收货人所在地邮政编码
country（字符串）: 国家
is_default（字符串）: 是否为默认地址
create_time（字符串）: 地址创建时间
)
```

**3.1.5** **订单表**

```
orders 
(order_id（字符串）：订单ID（主键）
user（字符串）：订购用户
total_amount（浮点数）：订单总金额
create_time（字符串）：订单创建时间
update_time（字符串）：订单更新时间
)
order_items (
order_item_id（字符串）：订单物品ID（主键）
order_id（字符串）：订单ID
product_id（字符串）：商品ID，关联商品基本信息
quantity（整数）：订购商品数量
price（浮点数）：商品单价
create_time（字符串）：订单明细创建时间)
3.1.6 购物车表
carts 
(cart_id（字符串）：购物车ID（主键）
user_id（字符串）：用户ID
product_id（字符串）：商品ID
quantity（整数）：商品数量
create_time（字符串）：购物车创建时间
)
```

**3.1.7** **优惠券表**

```
coupons 
(coupon_id（字符串）：优惠券ID（主键）
type（字符串）：优惠券类型（包括满减、折扣、固定金额等类型）
discount_value（字符串）：折扣值（包括满减金额、折扣比例等类型）
min_order_amount（浮点数）：最低订单金额要求
start_time（字符串）：优惠券生效时间
end_time（字符串）：优惠券失效时间
status（字符串）：优惠券状态（包含未使用、已使用、已过期三个状态）
create_time（字符串）：优惠券创建时间
update_time（字符串）：优惠券更新时间
)
```

**3.1.8** **评价表**

```
reviews
 (review_id（字符串）：评价ID（主键）
product_id（字符串）：商品ID，关联商品基本信息。
user_id（字符串）：用户ID，关联用户基本信息。
order_id（字符串）：订单ID，关联订单基本信息（新增字段，确保用户购买后才能评价）。
rating（整数）：评分（提供五个星级，此处记录星级数）。
comment（字符串）：评价内容。
create_time（字符串）：评价创建时间。
update_time（字符串）：评价更新时间。
)
```

## swagger

用于测试验收

地址：http://localhost:8088/swagger-ui/index.html

- 右上角选择接口分组
- 下方选择接口调用
  - 填写相应参数
  - 点击Execute按钮，执行接口

## 获取地区api

- 获取省名：`https://restapi.amap.com/v3/config/district?subdistrict=1&key=1e5fbfe5f8be999db82f1ca1fbd3e84a`
- 获取市名：`https://restapi.amap.com/v3/config/district?keywords=省名（例如陕西省）&subdistrict=1&key=1e5fbfe5f8be999db82f1ca1fbd3e84a`
- 获取区名：`https://restapi.amap.com/v3/config/district?keywords=区名（例如西安市）&subdistrict=1&key=1e5fbfe5f8be999db82f1ca1fbd3e84a`

> 前端调用，以表单形式调用接口即可

## tips

- 邮箱验证问题：自行配置qq邮箱开启邮箱发送服务获取授权码，教程见：https://www.jb51.net/program/333084orl.htm

  配置如下：

  ```yaml
    mail:
      host: smtp.qq.com
      username: 自己的邮箱
      password: 授权码
      port: 465
      properties:
        mail:
          smtp:
            auth: true
            starttls:
              enable: true
              required: true
            ssl:
              enable: true
  ```

  VerificationCodeUtils第172行换成自己邮箱

- 短信验证码服务：只有100条额度，需要提供接收短信的手机号（由于仅测试使用，只能最多5个手机号用于接收）

- 登录注册等方便测试，开发了前端页面访问地址为：http://localhost:8088/index.hml   

  - 消费统计见静态页面http://localhost:8088/consumption-stats.html
  
- 支付宝登录：

  - 需要内网穿透工具见文件中的natapp.exe，点击执行执行命令：`natapp -authtoken=704a58d134816c5a`，将Forwardding的域名复制到项目yaml文件的`auth-callback-url`，例如：`http://frqu36.natappfree.cc/api/alipay/auth/callback`

    ![image-20250418172218666](https://blogpic-1305209282.cos.ap-chengdu.myqcloud.com/img/image-20250418172218666.png)

  - 进入登录页面点击支付宝登录（需要先注册账号并绑定支付宝才行）

    - 绑定支付宝：由于无前端页面，
      1. 先登录之后利用swagger获取授权码地址即`/api/alipay/auth/url`接口获取支付宝登录链接，浏览器访问后，记录下返回的一串`appid`
      2. 根据appid再调用swagger的支付宝绑定接口即可
    - 支付登录：退出刚才账号，点击登录页面`http://localhost:8088/auth.html`的支付宝按钮进行登录，校验后即可登录

> 这些都需要自行配置数据库，创建好库表